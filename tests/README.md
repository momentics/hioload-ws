# Тестирование в hioload-ws

Этот документ описывает инфраструктуру тестирования в проекте hioload-ws.

## Структура тестов

- `tests/unit/` - Unit тесты для отдельных компонентов
- `tests/integration/` - Интеграционные тесты взаимодействия компонентов
- `tests/benchmarks/` - Бенчмарки производительности
- `tests/fake/` - Фейковые реализации интерфейсов для тестирования

## Фейковые реализации

Для тестирования используются фейковые реализации интерфейсов:

- `FakeBuffer` и `FakeBufferPool` - для тестирования пула буферов
- `FakeTransport` - для тестирования транспорта
- `FakePoller` и `FakeExecutor` - для тестирования poller и executor
- `FakeHandler` - для тестирования обработчиков
- `FakeEvent` и `FakeControl` - для других компонентов

## Запуск тестов

### С помощью скрипта:
```bash
./scripts/test.sh          # Запустить все тесты
./scripts/test.sh -c       # Запустить тесты с покрытием
./scripts/test.sh -v       # Запустить тесты с подробным выводом
./scripts/test.sh -r       # Запустить тесты с детектором гонок
```

### С помощью Make:
```bash
make test                  # Запустить все тесты
make test-unit             # Запустить unit тесты
make test-integration      # Запустить интеграционные тесты
make coverage              # Запустить тесты с отчетом о покрытии
make benchmark             # Запустить бенчмарки
make lint                  # Запустить линтер
```

## Написание тестов

### Unit тесты
Unit тесты должны тестировать отдельные функции и методы без зависимостей от внешних компонентов. Используйте фейковые реализации для изоляции тестируемого компонента.

### Интеграционные тесты
Интеграционные тесты проверяют взаимодействие между несколькими компонентами. Они обеспечивают, что компоненты корректно работают вместе.

### Бенчмарки
Бенчмарки используются для измерения производительности компонентов и отслеживания регрессий. Они должны покрывать критические пути производительности.

## Покрытие кода

Для генерации отчета о покрытии кода используйте:
```bash
make coverage
```

Это создаст файл `coverage.html` с визуализацией покрытия.

## Лучшие практики тестирования

1. Пишите тесты для всех публичных функций и методов
2. Проверяйте как нормальные, так и крайние случаи
3. Используйте фейковые реализации для изоляции компонентов
4. Пишите понятные имена тестов, отражающие тестируемый сценарий
5. Используйте табличные тесты для проверки нескольких сценариев в одном тесте
6. Не забывайте освобождать ресурсы (буферы) в тестах

## CI/CD

Все тесты запускаются в CI/CD pipeline перед каждым коммитом для обеспечения качества кода.